name: 'Nextcloud App Package'
description: 'Packages the Nextcloud app'
inputs:
  app_name:
    description: 'Name of the Nextcloud app'
    required: true
runs:
  using: "composite"
  steps:
    - name: Copy files to package directory
      shell: bash
      run: |
        mkdir -p package/${{ inputs.app_name }}
        rsync -av --progress \
          --exclude='package' \
          --exclude='.git' \
          --exclude='.github' \
          --exclude='.vscode' \
          --exclude='docker' \
          --exclude='docs' \
          --exclude='node_modules' \
          --exclude='/src' \
          --exclude='test' \
          --exclude='package-lock.json' \
          --exclude='composer.lock' \
          --exclude='composer-setup.php' \
          --exclude='.phpunit.result.cache' \
          --exclude='phpmd.xml' \
          --exclude='signing-key.key' \
          --exclude='package.json' \
          --exclude='composer.json' \
          --exclude='coverage.txt' \
          --exclude='signing-cert.crt' \
          --exclude='docker-compose.yml' \
          --exclude='webpack.config.js' \
          --exclude='.prettierrc' \
          --exclude='psalm.xml' \
          --exclude='phpunit.xml' \
          --exclude='tsconfig.json' \
          --exclude='changelog-ci-config.json' \
          --exclude='jest.config.js' \
          --exclude='.gitattributes' \
          --exclude='.php-cs-fixer.dist.php' \
          --exclude='.gitignore' \
          --exclude='.eslintrc.js' \
          --exclude='stylelint.config.js' \
          --exclude='.babelrc' \
          --exclude='.nvmrc' \
          ./ package/${{ inputs.app_name }}/

    - name: Create tarball
      shell: bash
      run: |
        cd package && tar -czf ../nextcloud-release.tar.gz ${{ inputs.app_name }}
